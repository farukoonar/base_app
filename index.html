<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathing App - Gamified</title>
    <style>
        /* --- 1. ADIM: CSS DEƒûƒ∞≈ûKENLERƒ∞ (TEMALAR ƒ∞√áƒ∞N) --- */
        :root {
            /* Varsayƒ±lan Tema (Cyber Blue) */
            --bg-color: #121212;
            --text-color: #fff;
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --circle-bg: radial-gradient(circle, #4facfe 0%, #00f2fe 100%);
            --btn-bg: linear-gradient(45deg, #4facfe, #00f2fe);
            --shadow-color: rgba(79, 172, 254, 0.4);
        }

        /* ORMAN TEMASI */
        body.theme-forest {
            --bg-color: #0f2015;
            --text-color: #e8f5e9;
            --primary-color: #2ecc71;
            --secondary-color: #27ae60;
            --circle-bg: radial-gradient(circle, #2ecc71 0%, #27ae60 100%);
            --btn-bg: linear-gradient(45deg, #2ecc71, #27ae60);
            --shadow-color: rgba(46, 204, 113, 0.4);
        }

        /* G√úN BATIMI TEMASI */
        body.theme-sunset {
            --bg-color: #2c0e0e;
            --text-color: #fff0f0;
            --primary-color: #ff6b6b;
            --secondary-color: #ff9f43;
            --circle-bg: radial-gradient(circle, #ff9f43 0%, #ff6b6b 100%);
            --btn-bg: linear-gradient(45deg, #ff9f43, #ff6b6b);
            --shadow-color: rgba(255, 107, 107, 0.4);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
            transition: background-color 0.5s, color 0.5s; /* Tema ge√ßi≈üi yumu≈üak olsun */
        }

        /* COIN G√ñSTERGESƒ∞ */
        .wallet-container {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .coin-icon { color: gold; }

        /* MAƒûAZA BUTONU */
        .shop-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: 1px solid rgba(255,255,255,0.3);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
        }

        /* MAƒûAZA MODAL (PENCERE) */
        .shop-modal {
            display: none; /* Ba≈ülangƒ±√ßta gizli */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid var(--primary-color);
            padding: 20px;
            border-radius: 15px;
            width: 300px;
            z-index: 100;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        .buy-btn {
            background: var(--primary-color);
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
        }
        .buy-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .close-shop {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid #555;
            color: #aaa;
            cursor: pointer;
            margin-top: 10px;
        }

        /* --- MEVCUT CSS KODLARI (G√úNCELLENMƒ∞≈û) --- */
        .stats-container {
            position: absolute;
            top: 80px; /* Biraz a≈üaƒüƒ± aldƒ±k */
            text-align: center;
            width: 100%;
        }
        .stats-text { font-size: 14px; opacity: 0.7; letter-spacing: 1px; }
        .set-count { font-size: 24px; font-weight: bold; color: var(--primary-color); }

        .container {
            position: relative;
            width: 320px;
            height: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 40px;
        }

        .breathing-circle {
            position: absolute;
            width: 200px;
            height: 200px;
            background: var(--circle-bg); /* Deƒüi≈üken kullanƒ±ldƒ± */
            border-radius: 50%;
            z-index: 1;
            opacity: 0.5;
            box-shadow: 0 0 30px var(--shadow-color); /* Deƒüi≈üken kullanƒ±ldƒ± */
        }
        .container.running .breathing-circle { animation: breatheAnimation 19s linear infinite; }

        svg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            transform: rotate(-90deg); z-index: 2; pointer-events: none;
        }
        .track { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 8; }
        .progress-ring {
            fill: none; stroke: var(--text-color); stroke-width: 8;
            stroke-linecap: round; stroke-dasharray: 942; stroke-dashoffset: 942;
        }
        .container.running .progress-ring { animation: progressAnimation 19s linear infinite; }

        .text-content {
            position: absolute; z-index: 3; text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        h2 { font-size: 28px; margin: 0; text-transform: uppercase; letter-spacing: 2px; color: var(--text-color); }
        .timer { font-size: 56px; font-weight: bold; margin: 0; color: var(--text-color); }
        .cycle-info { font-size: 14px; opacity: 0.6; margin-top: 5px; }

        .btn {
            padding: 15px 40px; font-size: 18px;
            background: var(--btn-bg); /* Deƒüi≈üken kullanƒ±ldƒ± */
            border: none; border-radius: 30px; color: #fff;
            cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-weight: bold;
            box-shadow: 0 4px 15px var(--shadow-color); /* Deƒüi≈üken kullanƒ±ldƒ± */
            transition: transform 0.2s; z-index: 10;
        }
        .btn:active { transform: scale(0.95); }
        .btn.stop { background: #ff4757; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4); }

        @keyframes progressAnimation { 0% { stroke-dashoffset: 942; } 100% { stroke-dashoffset: 0; } }
        @keyframes breatheAnimation {
            0% { transform: scale(1); opacity: 0.5; }
            21% { transform: scale(1.4); opacity: 1; }
            58% { transform: scale(1.4); opacity: 1; }
            100% { transform: scale(1); opacity: 0.5; }
        }
    </style>
</head>
<body>

    <div class="wallet-container">
        <span class="coin-icon">‚óè</span>
        <span id="coin-display">0</span> Coins
    </div>

    <button class="shop-btn" onclick="openShop()">üé® Themes</button>

    <div class="shop-modal" id="shop-modal">
        <h3 style="margin-top:0">Theme Store</h3>
        <p style="font-size:12px; color:#aaa;">Complete sets to earn coins!</p>
        
        <div class="shop-item">
            <span>Cyber Blue (Default)</span>
            <button class="buy-btn" onclick="equipTheme('default')">EQUIP</button>
        </div>

        <div class="shop-item">
            <span>Forest Green</span>
            <button class="buy-btn" id="btn-forest" onclick="buyTheme('forest', 50)">50 Coins</button>
        </div>

        <div class="shop-item">
            <span>Sunset Orange</span>
            <button class="buy-btn" id="btn-sunset" onclick="buyTheme('sunset', 100)">100 Coins</button>
        </div>

        <button class="close-shop" onclick="closeShop()">Close</button>
    </div>

    <div class="stats-container">
        <div class="stats-text">SETS COMPLETED</div>
        <div class="set-count" id="set-count">0</div>
    </div>

    <div class="container" id="container">
        <div class="breathing-circle"></div>
        <svg viewBox="0 0 320 320">
            <circle class="track" cx="160" cy="160" r="150"></circle>
            <circle class="progress-ring" cx="160" cy="160" r="150"></circle>
        </svg>
        <div class="text-content">
            <h2 id="action-text">Ready</h2>
            <p class="timer" id="timer-text">0</p>
            <p class="cycle-info" id="cycle-info">Cycle: 0/4</p>
        </div>
    </div>

    <button class="btn" id="control-btn" onclick="toggleApp()">START</button>

    <script>
        // --- DEƒûƒ∞≈ûKENLER VE AYARLAR ---
        const container = document.getElementById('container');
        const actionText = document.getElementById('action-text');
        const timerText = document.getElementById('timer-text');
        const controlBtn = document.getElementById('control-btn');
        const setCountDisplay = document.getElementById('set-count');
        const cycleInfoDisplay = document.getElementById('cycle-info');
        const coinDisplay = document.getElementById('coin-display');
        const shopModal = document.getElementById('shop-modal');

        const phases = [ { name: "Inhale", duration: 4 }, { name: "Hold", duration: 7 }, { name: "Exhale", duration: 8 } ];

        // --- VERƒ∞ Y√ñNETƒ∞Mƒ∞ (DATABASE Gƒ∞Bƒ∞) ---
        // Coin, Set ve Temalarƒ± Hafƒ±zadan √áek
        let totalSets = localStorage.getItem('sets') ? parseInt(localStorage.getItem('sets')) : 0;
        let totalCoins = localStorage.getItem('coins') ? parseInt(localStorage.getItem('coins')) : 0;
        let ownedThemes = localStorage.getItem('ownedThemes') ? JSON.parse(localStorage.getItem('ownedThemes')) : ['default'];
        let currentTheme = localStorage.getItem('currentTheme') || 'default';

        // ƒ∞lk Y√ºkleme Ayarlarƒ±
        setCountDisplay.innerText = totalSets;
        coinDisplay.innerText = totalCoins;
        applyTheme(currentTheme); // Son se√ßilen temayƒ± y√ºkle
        updateShopUI(); // Maƒüaza butonlarƒ±nƒ± g√ºncelle

        let isRunning = false;
        let currentCycle = 0;
        let phaseTimeout, countdownInterval;

        // --- MAƒûAZA VE TEMA Sƒ∞STEMƒ∞ ---
        
        function openShop() { shopModal.style.display = 'block'; }
        function closeShop() { shopModal.style.display = 'none'; }

        function buyTheme(themeName, cost) {
            // Zaten sahipse, direkt ku≈üan
            if (ownedThemes.includes(themeName)) {
                equipTheme(themeName);
                return;
            }

            // Sahip deƒüilse ve parasƒ± yetiyorsa
            if (totalCoins >= cost) {
                if(confirm("Buy this theme for " + cost + " coins?")) {
                    totalCoins -= cost; // Parayƒ± d√º≈ü
                    ownedThemes.push(themeName); // Envantere ekle
                    
                    // Kaydet
                    localStorage.setItem('coins', totalCoins);
                    localStorage.setItem('ownedThemes', JSON.stringify(ownedThemes));
                    
                    // Aray√ºz√º g√ºncelle
                    coinDisplay.innerText = totalCoins;
                    updateShopUI();
                    equipTheme(themeName); // Otomatik ku≈üan
                }
            } else {
                alert("Not enough coins! Breathe more to earn.");
            }
        }

        function equipTheme(themeName) {
            // 1. √ñnce t√ºm tema classlarƒ±nƒ± sil
            document.body.classList.remove('theme-forest', 'theme-sunset');
            
            // 2. Default deƒüilse yeni temayƒ± ekle
            if (themeName !== 'default') {
                document.body.classList.add('theme-' + themeName);
            }
            
            // 3. Hafƒ±zaya kaydet
            localStorage.setItem('currentTheme', themeName);
            currentTheme = themeName;
            updateShopUI();
        }

        function applyTheme(themeName) {
            if (themeName !== 'default') document.body.classList.add('theme-' + themeName);
        }

        function updateShopUI() {
            // Butonlarƒ±n yazƒ±larƒ±nƒ± g√ºncelle (BUY vs EQUIP)
            checkButton('forest', 'btn-forest', 50);
            checkButton('sunset', 'btn-sunset', 100);
        }

        function checkButton(theme, btnId, cost) {
            const btn = document.getElementById(btnId);
            if (ownedThemes.includes(theme)) {
                btn.innerText = currentTheme === theme ? "EQUIPPED" : "EQUIP";
                btn.style.background = currentTheme === theme ? "#555" : "#fff";
                btn.style.color = currentTheme === theme ? "#fff" : "#000";
            } else {
                btn.innerText = cost + " Coins";
            }
        }


        // --- OYUN MEKANƒ∞ƒûƒ∞ ---

        function toggleApp() { isRunning ? stopApp() : startApp(); }

        function startApp() {
            isRunning = true;
            currentCycle = 0;
            controlBtn.innerText = "STOP";
            controlBtn.classList.add('stop');
            container.classList.add('running');
            runPhase(0);
        }

        function stopApp(finishedSet = false) {
            isRunning = false;
            clearTimeout(phaseTimeout);
            clearInterval(countdownInterval);
            container.classList.remove('running');
            controlBtn.innerText = "START";
            controlBtn.classList.remove('stop');
            
            if (finishedSet) {
                actionText.innerText = "Set Done!";
                timerText.innerText = "+10"; // √ñd√ºl animasyonu gibi
                cycleInfoDisplay.innerText = "Coins Earned!";
            } else {
                actionText.innerText = "Ready";
                timerText.innerText = "0";
                cycleInfoDisplay.innerText = "Cycle: 0/4";
            }
        }

        function runPhase(phaseIndex) {
            if (!isRunning) return;

            if (phaseIndex >= phases.length) {
                currentCycle++;
                if (currentCycle >= 4) {
                    completeSet(); // Set bitince √∂d√ºl ver
                    return;
                }
                phaseIndex = 0;
                container.classList.remove('running');
                void container.offsetWidth; 
                container.classList.add('running');
            }

            const currentPhase = phases[phaseIndex];
            cycleInfoDisplay.innerText = `Cycle: ${currentCycle + 1}/4`;
            actionText.innerText = currentPhase.name;
            timerText.innerText = currentPhase.duration;

            phaseTimeout = setTimeout(() => { runPhase(phaseIndex + 1); }, currentPhase.duration * 1000);

            let timeLeft = currentPhase.duration;
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                timeLeft--;
                if (timeLeft >= 0) timerText.innerText = timeLeft;
            }, 1000);
        }

        function completeSet() {
            // 1. ƒ∞statistikleri Artƒ±r
            totalSets++;
            
            // 2. √ñD√úL MANTIƒûI: Her set = 10 Coin
            const reward = 1000;
            totalCoins += reward;

            // 3. Kaydet
            localStorage.setItem('sets', totalSets);
            localStorage.setItem('coins', totalCoins);

            // 4. G√ºncelle
            setCountDisplay.innerText = totalSets;
            coinDisplay.innerText = totalCoins;
            updateShopUI(); // Coin deƒüi≈ütiƒüi i√ßin marketi g√ºncelle

            stopApp(true);
        }
    </script>
</body>
</html>
